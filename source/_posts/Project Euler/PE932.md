---
title: PE932
date: 2025-5-28 00:21:00
mathjax: true
tags:
- PE
- Math
categories:
- Project Euler
---


## 题目描述

> 对于年份 $2025$，有如下等式：
>
> $$
> $$

2025 = (20 + 25)^2
<!-- more -->


> 我们将满足以下性质的正整数称为**2025-数**：
>
> * 存在正整数 $a, b$，拼接 $a$ 和 $b$ 得到数 $n$（记作 $ab$）；
> * 满足 $ab = (a + b)^2$；
> * 其中 $b$ 必须正好占据 $k$ 位（即不能省略前导 0，形如 $a=98, b=1$ 拼接成 $9801$ 就不合法）。

例如：

* ✅ `2025 = (20 + 25)^2`
* ✅ `3025 = (30 + 25)^2`
* ✅ `81 = (8 + 1)^2`
* ❌ `9801` 虽然是 $99^2$，但若用 $a=98, b=1$ 拼接得到的是 `981`，与 $9801 \ne (a + b)^2$ 不符。

定义 $T(n)$ 表示所有位数 $\le n$ 的 2025-数之和。已知：

$$
T(4) = 5131
$$

求：

$$
T(16) = ?
$$

---

## 分析思路

核心目标是找到所有满足下式的正整数对 $(a, b)$：

$$
\text{拼接}(a, b) = (a + b)^2
$$

我们设：

* $s = a + b$（平方根）
* $k$ 是 $b$ 的位数
* $N = s^2$ 是拼接后的数字

拼接 $a$ 和 $b$ 的操作等价于：

$$
N = a \cdot 10^k + b
$$

而 $s = a + b$，则：

$$
s^2 = (s - b) \cdot 10^k + b
\Rightarrow s^2 = s \cdot 10^k - b \cdot (10^k - 1)
$$

整理后得：

$$
b = \frac{s \cdot (10^k - s)}{10^k - 1}
$$

只要这个 $b$ 是整数，且正好是 $k$ 位数，就找到了一个合法的 2025-数 $s^2$。

---

## 筛选条件

对每一对 $(s, k)$：

1. $1 \le k \le 16$（最多 16 位拼接）
2. $1 \le s \le \sqrt{10^{16}} = 10^8$
3. 计算：

   $$
   b = \frac{s(10^k - s)}{10^k - 1}
   $$
4. 检查：

   * $b$ 是整数（整除）
   * $b$ 在 $[10^{k-1}, 10^k)$（确保正好 $k$ 位）
   * $a = s - b > 0$
5. 将 $N = s^2$ 加入答案集合中（去重）

---

## 算法实现（C++）

```cpp
#include <bits/stdc++.h>
#include <chrono>
using namespace std;
using namespace std::chrono;

typedef unsigned long long ull;

int main() {
    auto start = high_resolution_clock::now();

    vector<ull> pow10(17, 1);
    for (int i = 1; i <= 16; ++i) pow10[i] = pow10[i - 1] * 10;

    unordered_set<ull> valid2025;
    for (int k = 1; k <= 16; ++k) {
        ull M = pow10[k] - 1;
        for (ull s = 1; ; ++s) {
            ull s2 = s * s;
            if (s2 >= pow10[16]) break;

            ull numerator = s * (pow10[k] - s);
            if (numerator % M != 0) continue;

            ull b = numerator / M;
            if (b < pow10[k - 1] || b >= pow10[k]) continue;

            ull a = s - b;
            if (a == 0) continue;

            valid2025.insert(s2);
        }
    }

    ull T16 = 0;
    for (ull n : valid2025) T16 += n;
    cout << "T(16) = " << T16 << endl;

    auto end = high_resolution_clock::now();
    auto duration = duration_cast<milliseconds>(end - start);
    cout << "Execution time: " << duration.count() << " ms" << endl;

    return 0;
}
```

---

## 关键优化

* **拼接用乘法代替字符串处理**：用 `a * 10^k + b` 拼接，避免字符串操作。
* **提前剪枝**：一旦 $s^2 \ge 10^{16}$，立刻终止循环。
* **精确控制 $b$ 的位数**：必须满足 $10^{k-1} \le b < 10^k$，否则像 $b=1, k=2$ 就是非法拼接。
* **使用 `unordered_set` 去重**：避免重复计入同一个 2025-数。

---

## 运行结果

```
T(16) = 
Execution time: 11249 ms 
```

---
